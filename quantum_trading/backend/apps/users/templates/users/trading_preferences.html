<!-- templates/users/trading_preferences.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Trading Preferences - Quantum Trading System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom border-secondary">
    <h1 class="h2 text-warning">
        <i class="fas fa-sliders-h me-2"></i>Trading Preferences
    </h1>
</div>

<div class="row">
    <!-- Navigation Sidebar -->
    <div class="col-lg-3 mb-4">
        <div class="card analysis-card">
            <div class="card-body">
                <div class="nav flex-column nav-pills">
                    <a class="nav-link text-light" href="{% url 'profile' %}">
                        <i class="fas fa-user me-2"></i>Personal Info
                    </a>
                    <a class="nav-link active text-light bg-primary" href="{% url 'trading_preferences' %}">
                        <i class="fas fa-sliders-h me-2"></i>Trading Preferences
                    </a>
                    <a class="nav-link text-light" href="{% url 'broker_connection' %}">
                        <i class="fas fa-plug me-2"></i>Broker Connections
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Trading Preferences Form -->
    <div class="col-lg-9">
        <form method="post">
            {% csrf_token %}

            <!-- Risk Management -->
            <div class="card analysis-card mb-4">
                <div class="card-header border-bottom border-secondary">
                    <h5 class="card-title mb-0 text-warning">
                        <i class="fas fa-shield-alt me-2"></i>Risk Management
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="id_max_position_size" class="form-label text-light">
                                Maximum Position Size ($)
                            </label>
                            <input type="number" name="max_position_size"
                                   class="form-control bg-dark text-light border-secondary"
                                   id="id_max_position_size" min="100" max="100000" step="100"
                                   value="{{ form.max_position_size.value|default:'1000' }}" required>
                            <div class="form-text text-muted">
                                Maximum amount to invest in a single position
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="id_max_daily_loss" class="form-label text-light">
                                Maximum Daily Loss ($)
                            </label>
                            <input type="number" name="max_daily_loss"
                                   class="form-control bg-dark text-light border-secondary"
                                   id="id_max_daily_loss" min="10" max="5000" step="10"
                                   value="{{ form.max_daily_loss.value|default:'500' }}" required>
                            <div class="form-text text-muted">
                                Maximum allowed loss per trading day
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="id_max_portfolio_risk" class="form-label text-light">
                                Maximum Portfolio Risk (%)
                            </label>
                            <input type="number" name="max_portfolio_risk"
                                   class="form-control bg-dark text-light border-secondary"
                                   id="id_max_portfolio_risk" min="0.1" max="10.0" step="0.1"
                                   value="{{ form.max_portfolio_risk.value|default:'2.0' }}" required>
                            <div class="form-text text-muted">
                                Maximum portfolio risk percentage
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="id_default_timeframe" class="form-label text-light">
                                Default Timeframe
                            </label>
                            <select name="default_timeframe" class="form-select bg-dark text-light border-secondary"
                                    id="id_default_timeframe" required>
                                {% for value, label in form.default_timeframe.field.choices %}
                                <option value="{{ value }}" {% if form.default_timeframe.value == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trading Strategy -->
            <div class="card analysis-card mb-4">
                <div class="card-header border-bottom border-secondary">
                    <h5 class="card-title mb-0 text-warning">
                        <i class="fas fa-robot me-2"></i>Automated Trading
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-light">Quantum Signal Following</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoQuantum" checked>
                                <label class="form-check-label text-light" for="autoQuantum">
                                    Enable automated trading based on quantum signals
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="minConfidence" class="form-label text-light">
                                Minimum Signal Confidence
                            </label>
                            <input type="range" class="form-range" id="minConfidence" min="50" max="95" value="70">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">50%</small>
                                <small class="text-warning" id="confidenceValue">70%</small>
                                <small class="text-muted">95%</small>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="positionSize" class="form-label text-light">
                                Position Size per Trade (%)
                            </label>
                            <input type="range" class="form-range" id="positionSize" min="0.5" max="5.0" step="0.1" value="2.0">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">0.5%</small>
                                <small class="text-warning" id="positionSizeValue">2.0%</small>
                                <small class="text-muted">5.0%</small>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="maxPositions" class="form-label text-light">
                                Maximum Concurrent Positions
                            </label>
                            <input type="number" class="form-control bg-dark text-light border-secondary"
                                   id="maxPositions" min="1" max="20" value="10">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Favorite Tickers -->
            <div class="card analysis-card mb-4">
                <div class="card-header border-bottom border-secondary">
                    <h5 class="card-title mb-0 text-warning">
                        <i class="fas fa-star me-2"></i>Watchlist & Favorites
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="id_favorite_tickers" class="form-label text-light">
                            Favorite Tickers
                        </label>
                        <textarea name="favorite_tickers" class="form-control bg-dark text-light border-secondary"
                                  id="id_favorite_tickers" rows="3"
                                  placeholder="Enter symbols separated by commas (e.g., AAPL, TSLA, SPY)">{{ form.favorite_tickers.value|default:'' }}</textarea>
                        <div class="form-text text-muted">
                            These symbols will appear in your watchlist and be prioritized for analysis
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6 class="text-warning mb-3">Popular Symbols</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for symbol in ['AAPL', 'TSLA', 'MSFT', 'GOOGL', 'AMZN', 'META', 'NVDA', 'SPY', 'QQQ', 'BTC-USD'] %}
                            <button type="button" class="btn btn-outline-secondary btn-sm"
                                    onclick="addToFavorites('{{ symbol }}')">
                                {{ symbol }}
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="text-end">
                <button type="submit" class="btn btn-warning btn-lg">
                    <i class="fas fa-save me-2"></i>Save Trading Preferences
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Update range values in real-time
    document.getElementById('minConfidence').addEventListener('input', function() {
        document.getElementById('confidenceValue').textContent = this.value + '%';
    });

    document.getElementById('positionSize').addEventListener('input', function() {
        document.getElementById('positionSizeValue').textContent = this.value + '%';
    });

    function addToFavorites(symbol) {
        const textarea = document.getElementById('id_favorite_tickers');
        const current = textarea.value.trim();
        if (current) {
            // Check if symbol already exists
            if (!current.includes(symbol)) {
                textarea.value = current + ', ' + symbol;
            }
        } else {
            textarea.value = symbol;
        }
    }

    // Initialize range values on page load
    $(document).ready(function() {
        $('#confidenceValue').text($('#minConfidence').val() + '%');
        $('#positionSizeValue').text($('#positionSize').val() + '%');
    });
</script>
{% endblock %}